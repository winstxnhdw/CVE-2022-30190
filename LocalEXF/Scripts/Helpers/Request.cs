using System;
using System.IO;
using System.Net.Http;
using System.Threading.Tasks;

public class Request : IDisposable {
    MultipartFormDataContent RequestContent { get; }
    HttpClient HTTPClient { get; }

    Request() {
        this.RequestContent = new MultipartFormDataContent();
        this.HTTPClient = new HttpClient();
    }

    public Request AddString(string key, string value) {
        StringContent stringContent = new StringContent(value);
        this.RequestContent.Add(stringContent, key);
        return this;
    }

    public Request AddFile(string key, string filePath) {
        FileStream fileStream = File.OpenRead(filePath);
        StreamContent streamContent = new StreamContent(fileStream);
        this.RequestContent.Add(streamContent, key, filePath);
        return this;
    }

    public async Task<Request> Post(string hostNameOrAddress) {
        await this.HTTPClient.PostAsync(hostNameOrAddress, this.RequestContent);
        return this;
    }

    public void Dispose() {
        this.RequestContent.Dispose();
        this.HTTPClient.Dispose();
    }

    public static Request CreateFormData() => new Request();
}